function getFeedbackCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`)
if(2===t.length)return t.pop().split(";").shift()}function loadFeedbacks(e=0){feedbackPageSize=parseInt(document.getElementById("feedbackPageSize").value),fetch(`/admin/api/feedback?page=${e}&size=${feedbackPageSize}`).then((e=>e.json())).then((e=>{renderFeedbacks(e.content),feedbackTotalPages=e.totalPages,feedbackCurrentPage=e.number,renderFeedbackPagination()}))}function renderFeedbacks(e){const t=document.getElementById("feedbackTableBody")
t.innerHTML="",e.forEach((e=>{const a=document.createElement("tr")
a.innerHTML=`\n      <td>${e.id}</td>\n      <td><a href="#" class="feedback-text-link" data-text="${encodeURIComponent(e.text)}">${e.text.length>40?e.text.substring(0,40)+"…":e.text}</a></td>\n      <td>${e.remoteAdd||""}</td>\n      <td>${e.user||""}</td>\n      <td><button class="btn btn-sm btn-danger delete-feedback-btn" data-id="${e.id}">Удалить</button></td>\n    `,t.appendChild(a)}))}function renderFeedbackPagination(){const e=document.getElementById("feedbackPagination")
if(e.innerHTML="",feedbackTotalPages<=1)e.style.display="none"
else{e.style.display="",e.innerHTML+=`<li class="page-item${0===feedbackCurrentPage?" disabled":""}"><a class="page-link" href="#" data-page="${feedbackCurrentPage-1}">&laquo;</a></li>`
for(let t=0;t<feedbackTotalPages;t++)e.innerHTML+=`<li class="page-item${t===feedbackCurrentPage?" active":""}"><a class="page-link" href="#" data-page="${t}">${t+1}</a></li>`
e.innerHTML+=`<li class="page-item${feedbackCurrentPage===feedbackTotalPages-1?" disabled":""}"><a class="page-link" href="#" data-page="${feedbackCurrentPage+1}">&raquo;</a></li>`,e.querySelectorAll("a.page-link").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault()
const t=parseInt(this.getAttribute("data-page"))
!isNaN(t)&&t>=0&&t<feedbackTotalPages&&loadFeedbacks(t)}))}))}}let feedbackCurrentPage=0,feedbackPageSize=50,feedbackTotalPages=1
document.addEventListener("DOMContentLoaded",(function(){loadFeedbacks(),document.getElementById("feedbackPageSize").onchange=()=>loadFeedbacks(0),document.getElementById("feedbackTableBody").addEventListener("click",(function(e){if(e.target.classList.contains("delete-feedback-btn")){const t=e.target.getAttribute("data-id")
if(confirm("Удалить обращение?")){const e=getFeedbackCookie("X-XSRF-TOKEN")
fetch(`/admin/api/feedback/${t}`,{method:"DELETE",headers:{"X-XSRF-TOKEN":e}}).then((()=>loadFeedbacks(feedbackCurrentPage)))}}if(e.target.classList.contains("feedback-text-link")){e.preventDefault()
const t=decodeURIComponent(e.target.getAttribute("data-text"))
document.getElementById("feedbackTextContent").textContent=t,new bootstrap.Modal(document.getElementById("feedbackTextModal")).show()}}))}))
